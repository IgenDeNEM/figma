globalPriceMultiplier = 1
PI = math.pi
TWO_PI = 2 * PI
PI_2 = PI / 2

idCardOffsets = {
  -0.3594,
  -0.1783,
  -0.0003,
  0.1792,
  0.3511
}
lobbyCoords = {
  {
    -1392.2332,
    2483.7261,
    64.3333,
    75,
    "Silver Vein",
    7,
    -1383.3199,
    2481.1626,
    67.1384,
    -15,
    "v4_mine_entrance1"
  },
  {
    -1382.5136,
    2308.9375,
    55.5651,
    110,
    "Golden Summit",
    7,
    -1372.9541,
    2312.1562,
    57.8662,
    19.5,
    "v4_mine_entrance2"
  },
  {
    -1209.3429,
    2052.2058,
    78.3374,
    390,
    "Diamond Depths",
    7,
    -1204.8247,
    2044.1183,
    80.4349,
    300,
    "v4_mine_entrance3"
  },
  {
    -1199.7081,
    2248.9207,
    101.5691,
    209,
    "Emerald Grotto",
    7,
    -1204.2206,
    2257.3367,
    104.1957,
    119,
    "v4_mine_entrance4"
  },
  {
    -1274.3549,
    2231.1531,
    100.0635,
    160,
    "Granite Ridge",
    7,
    -1271.4425,
    2240.0256,
    102.0696,
    70,
    "v4_mine_entrance5"
  },
  {
    -1323.0405,
    2286.3484,
    94.9378,
    105,
    "Sapphire Shaft",
    7,
    -1313.8759,
    2288.4141,
    97.2358,
    15,
    "v4_mine_entrance6"
  }
}
lobbyPosX = 0
lobbyPosY = 0
lobbyPosZ = 7000
lobbyExitX = lobbyPosX - 68.5956
lobbyExitY = lobbyPosY - 4.1388
lobbyExitZ = lobbyPosZ + 15.4
lobbyExitAngle = 280
minePosX = 0
minePosY = 0
minePosZ = 9000
mineHqX = minePosX - 12
mineHqY = minePosY
mineHqZ = minePosZ
mineCoords = {
  {
    -62.031,
    22.1692,
    14.4102,
    -19,
    0,
    0,
    -66.1584,
    22.957,
    16.4061,
    -20
  },
  {
    -21.269,
    50.9555,
    14.4102,
    -88,
    0,
    0,
    -20.6588,
    55.119,
    16.3934,
    -88.7
  },
  {
    13.4124,
    47.2191,
    14.4102,
    -95,
    0,
    0,
    13.8231,
    51.3455,
    16.3899,
    -95
  },
  {
    42.425,
    37.3044,
    14.4102,
    -120,
    0,
    0,
    43.9592,
    41.2286,
    16.4061,
    -122
  },
  {
    65.2181,
    10.219,
    14.4102,
    -168,
    0,
    0,
    69.4343,
    10.3672,
    16.3934,
    -167
  },
  {
    63.3537,
    -21.5917,
    14.4102,
    -200,
    0,
    0,
    67.0441,
    -23.5695,
    15.9222,
    -200
  },
  {
    37.7136,
    -47.1174,
    14.4102,
    -257,
    0,
    0,
    37.9069,
    -51.3267,
    16.3934,
    -258
  },
  {
    1.2827,
    -51.8774,
    14.4102,
    -269,
    0,
    0,
    1.2659,
    -56.0249,
    16.3982,
    -270
  },
  {
    -29.9952,
    -45.9858,
    14.4102,
    -294,
    0,
    0,
    -32.3298,
    -49.4811,
    16.3934,
    -294.5
  },
  {
    -54.0439,
    -27.742,
    14.4102,
    -324,
    0,
    0,
    -57.0167,
    -30.6927,
    16.3934,
    -323
  },
  {
    48.5383,
    -11.2455,
    6.4102,
    -193,
    0,
    0,
    52.4045,
    -12.9354,
    8.3934,
    -193
  },
  {
    26.5044,
    -35.1056,
    6.4102,
    -258,
    0,
    0,
    27.9762,
    -39.0322,
    8.3934,
    -258
  },
  {
    -9.8843,
    -36.2369,
    6.4102,
    -275,
    0,
    0,
    -10.3376,
    -40.3593,
    8.3982,
    -276
  },
  {
    -44.4243,
    -18.7358,
    6.4102,
    -324,
    0,
    0,
    -48.2133,
    -20.5879,
    8.3982,
    -323.5
  },
  {
    -49.6838,
    15.4658,
    6.4102,
    -30,
    0,
    0,
    -52.8896,
    18.1905,
    8.3934,
    -30
  },
  {
    -22.0536,
    33.4099,
    6.4102,
    -93,
    0,
    0,
    -22.4636,
    37.5806,
    8.4061,
    -93
  },
  {
    12.9467,
    32.0101,
    6.4102,
    -92,
    0,
    0,
    13.8879,
    36.1208,
    8.3934,
    -92.5
  },
  {
    32.4336,
    -1.7902,
    0.0102,
    -166,
    0,
    0,
    36.6303,
    -1.529,
    1.9934,
    -167
  },
  {
    3.7477,
    13.9176,
    0.0102,
    -89.5,
    0,
    0,
    4.4661,
    18.064,
    1.9934,
    -90
  },
  {
    -31.523,
    10.7258,
    0.0102,
    -15,
    0,
    0,
    -35.6904,
    11.2024,
    1.9934,
    -15
  }
}
for r4_0 = 1, #mineCoords, 1 do
  local r5_0 = mineCoords[r4_0]
  local r6_0 = r5_0[4]
  r5_0[1] = lobbyPosX + r5_0[1]
  r5_0[2] = lobbyPosY + r5_0[2]
  r5_0[3] = lobbyPosZ + r5_0[3]
  r5_0[7] = lobbyPosX + r5_0[7]
  r5_0[8] = lobbyPosY + r5_0[8]
  r5_0[9] = lobbyPosZ + r5_0[9]
  r5_0[6] = r6_0
  r6_0 = math.rad(r6_0)
  r5_0[4] = math.cos(r6_0)
  r5_0[5] = math.sin(r6_0)
  r6_0 = math.rad(r5_0[10])
  r5_0[11] = math.cos(r6_0)
  r5_0[12] = math.sin(r6_0)
end
local r1_0 = 10
local r2_0 = 32
local r3_0 = r1_0 * r2_0
function getLobbyFromCorridor(r0_2)
  -- line: [93, 97] id: 2
  local r1_2 = math.floor((r0_2 - 1) / r1_0) + 1
  return r1_2, r0_2 - (r1_2 - 1) * r1_0
end
function getLobbyCorridorBaseId(r0_3)
  -- line: [99, 101] id: 3
  return (r0_3 - 1) * r1_0
end
function getCorridorIdFromLobbyCorridor(r0_4, r1_4)
  -- line: [103, 105] id: 4
  return (r0_4 - 1) * r1_0 + r1_4
end
function getLobbyMineBaseId(r0_5, r1_5)
  -- line: [107, 109] id: 5
  return (r0_5 - 1) * r3_0 + (r1_5 - 1) * r2_0
end
function getLobbyMineId(r0_6, r1_6)
  -- line: [111, 113] id: 6
  return getLobbyMineBaseId(getLobbyFromCorridor(r0_6)) + r1_6
end
function getLobbyFromMineId(r0_7)
  -- line: [115, 120] id: 7
  local r1_7 = math.floor(r0_7 / r3_0) + 1
  local r2_7 = math.floor((r0_7 - (r1_7 - 1) * r3_0) / r2_0) + 1
  return r1_7, r2_7, r0_7 - getLobbyMineBaseId(r1_7, r2_7)
end
function isValidLobbyCorridor(r0_8)
  -- line: [122, 134] id: 8
  local r1_8, r2_8 = getLobbyFromCorridor(r0_8)
  if r1_8 < 1 or #lobbyCoords < r1_8 then
    return false
  end
  if r2_8 < 1 or lobbyCoords[r1_8][6] < r2_8 then
    return false
  end
  return true
end
function validateMineId(r0_9, r1_9)
  -- line: [136, 138] id: 9
  local r2_9 = r1_9
  if r2_9 then
    if r0_9 < r1_9 then
      r2_9 = r1_9 <= r0_9 + r2_0
    end
  end
  return r2_9
end
  function formatMineName(r0_9)
    -- line: [104, 108] id: 9
    local r1_9, r2_9 = getLobbyFromMineId(r0_9)
    return r0_9 - getLobbyMineBaseId(r1_9, r2_9) .. ". ajtó"
  end
function formatNumber(r0_11)
  -- line: [147, 160] id: 11
  local r1_11 = tostring(r0_11)
  local r2_11 = 0
  repeat
    r1_11, r2_11 = string.gsub(r1_11, "^(-?%d+)(%d%d%d)", "%1 %2")
  until r2_11 == 0
  return r1_11
end
function convertMineCoordinates(r0_12, r1_12)
  -- line: [162, 165] id: 12
  return math.floor(r0_12 / 6 - 0.5) + 1, math.floor(r1_12 / 6 - 0.5) + 1
end
function convertSingleMineCoordinate(r0_13)
  -- line: [167, 169] id: 13
  return math.floor(r0_13 / 6 - 0.5) + 1
end
rentPrice = 50000 --math.floor(50000 * globalPriceMultiplier + 0.5) (ez nem sees)
rentDeposit = 4 * rentPrice
ppRentPrice = 1750
ppRentDeposit = 0 * ppRentPrice
rentDuration = 604800
renewalDuration = 172800
maxWorkers = 10
maxWorkersInside = 5
permissionFlags = {
  OPEN_CLOSE = bitLShift(1, 0),
  MINING = bitLShift(1, 1),
  USE_BOMB = bitLShift(1, 2),
  PICK_ORES = bitLShift(1, 3),
  CONSTRUCT_LAMP = bitLShift(1, 4),
  USE_RAILCAR = bitLShift(1, 5),
  USE_SWITCHES = bitLShift(1, 6),
  CONSTRUCT_RAIL = bitLShift(1, 7),
  USE_SORTER_MACHINE = bitLShift(1, 8),
  USE_FOUNDRY = bitLShift(1, 9),
  ORDER = bitLShift(1, 10),
  COLLECT_PRODUCT = bitLShift(1, 11),
}
permissionDescriptions = {
  [permissionFlags.OPEN_CLOSE] = "Nyitás/Zárás",
  [permissionFlags.MINING] = "Bányászat",
  [permissionFlags.USE_BOMB] = "Robbantás",
  [permissionFlags.PICK_ORES] = "Ércek pakolása",
  [permissionFlags.CONSTRUCT_LAMP] = "Lámpa felszerelése",
  [permissionFlags.USE_RAILCAR] = "Vonat használata",
  [permissionFlags.USE_SWITCHES] = "Váltókezelés",
  [permissionFlags.CONSTRUCT_RAIL] = "Sínépítés",
  [permissionFlags.USE_SORTER_MACHINE] = "Válogatógép kezelése",
  [permissionFlags.USE_FOUNDRY] = "Kohó kezelés",
  [permissionFlags.ORDER] = "Rendelés",
  [permissionFlags.COLLECT_PRODUCT] = "Késztermék begyűjtése",
}
permissionList = {}
for r7_0 in pairs(permissionFlags) do
  table.insert(permissionList, r7_0)
end
table.sort(permissionList, function(r0_14, r1_14)
  -- line: [225, 227] id: 14
  return permissionFlags[r0_14] < permissionFlags[r1_14]
end)
function canExtendShaftAt(_ARG_0_, _ARG_1_)
  return _ARG_0_ > 0 and _ARG_0_ % 2 == 1 and _ARG_1_ % 2 == 0
end
local r4_0 = {}
local r5_0 = {}
local r6_0 = {}
local r7_0 = {}
function prad(r0_16)
  -- line: [242, 247] id: 16
  if not r4_0[r0_16] then
    r4_0[r0_16] = math.rad(math.floor((r0_16 / 90 + 0.5)) * 90)
  end
  return r4_0[r0_16]
end
function pcos(r0_17)
  -- line: [249, 254] id: 17
  if not r5_0[r0_17] then
    r5_0[r0_17] = math.floor(math.cos(r0_17) + 0.5)
  end
  return r5_0[r0_17]
end
function psin(r0_18)
  -- line: [256, 261] id: 18
  if not r6_0[r0_18] then
    r6_0[r0_18] = math.floor(math.sin(r0_18) + 0.5)
  end
  return r6_0[r0_18]
end
function patan2(r0_19, r1_19)
  -- line: [263, 273] id: 19
  if not r7_0[r0_19] then
    r7_0[r0_19] = {}
  end
  if not r7_0[r0_19][r1_19] then
    r7_0[r0_19][r1_19] = math.atan2(r0_19, r1_19)
  end
  return r7_0[r0_19][r1_19]
end
wallVertexNumX = 20
wallVertexNumY = 19
wallVertexCount = wallVertexNumX * wallVertexNumY * 6
wallBlockNumX = 3
wallBlockNumY = 3
wallBlockCount = wallBlockNumX * wallBlockNumY
wallMeshWidth = 3.5
wallMeshHeight = 2.83206
wallTextureWidth = 256
wallTextureHeight = 256
wallMinimumDepth = 0.085
wallMaximumDepth = 0.85
function remapRgb(r0_20, r1_20, r2_20, r3_20)
  -- line: [296, 301] id: 20
  local r4_20 = r0_20 / 255
  local r5_20 = r1_20 / 255
  local r6_20 = r2_20 / 255
  local r7_20 = nil	-- notice: implicit variable refs by block#[3]
  if r3_20 then
    r7_20 = r3_20 / 255
    if not r7_20 then
      r7_20 = 1
    end
  end
  return r4_20, r5_20, r6_20, r7_20
end
local r8_0 = {
  --[[sapphire = {
    itemId = 701,
    itemProbability = 15,
    forexIndex = "SAP",
    displayName = "Zafír",
    actionName = "zafírt",
    sorterOffset = 0.322243,
    metallicOre = true,
  },--]]
  amber = {
    itemId = 702,
    itemProbability = 30,
    forexIndex = "AMB",
    displayName = "Borostyán",
    actionName = "borostyánt",
    sorterOffset = 0.966825,
    metallicOre = true,
  },
  amethyst = {
    itemId = 703,
    itemProbability = 110,
    forexIndex = "AME",
    displayName = "Ametiszt",
    actionName = "ametisztet",
    sorterOffset = 1.611407,
    metallicOre = true,
  },
}
r8_0.bauxite = {
  itemId = 704,
  itemProbability = 425,
  forexIndex = "ALU",
  displayName = "Bauxit",
  actionName = "alumínium rudat",
  ingotName = "Alumínium",
  ingotNamePrefix = "az",
  meltingPoint = 670,
  meltingColor = {
    remapRgb(198, 198, 198)
  },
  sorterOffset = 2.255989,
}
r8_0.chromium = {
  itemId = 705,
  itemProbability = 160,
  forexIndex = "CHR",
  displayName = "Krómérc",
  actionName = "króm rudat",
  ingotName = "Króm",
  ingotNamePrefix = "a",
  meltingPoint = 1920,
  meltingColor = {
    remapRgb(182, 182, 250)
  },
  sorterOffset = 2.900571,
  metallicOre = true,
}
r8_0.coal = {
  itemId = 706,
  itemProbability = 700,
  forexIndex = "COL",
  displayName = "Szén",
  actionName = "szenet",
  sorterOffset = 3.545153,
}
r8_0.copper = {
  itemId = 707,
  itemProbability = 300,
  forexIndex = "COP",
  displayName = "Rézérc",
  actionName = "rézrudat",
  ingotName = "Réz",
  ingotNamePrefix = "a",
  meltingPoint = 1100,
  meltingColor = {
    remapRgb(235, 134, 88)
  },
  sorterOffset = 4.189735,
  metallicOre = true,
}
r8_0.diamond = {
  itemId = 708,
  itemProbability = 10,
  forexIndex = "DIA",
  displayName = "Gyémánt",
  actionName = "gyémántot",
  sorterOffset = 4.834317,
  metallicOre = true,
}
r8_0.emerald = {
  itemId = 709,
  itemProbability = 20,
  forexIndex = "EMD",
  displayName = "Smaragd",
  actionName = "smaragdot",
  sorterOffset = 5.478899,
  metallicOre = true,
}
r8_0.gold = {
  itemId = 710,
  itemProbability = 45,
  forexIndex = "GOL",
  displayName = "Aranyérc",
  actionName = "aranyrudat",
  ingotName = "Arany",
  ingotNamePrefix = "az",
  meltingPoint = 1100,
  meltingColor = {
    remapRgb(245, 210, 128)
  },
  sorterOffset = 6.123481,
  metallicOre = true,
}
r8_0.iron = {
  itemId = 711,
  itemProbability = 600,
  forexIndex = "IRN",
  displayName = "Vasérc",
  actionName = "vasrudat",
  ingotName = "Vas",
  ingotNamePrefix = "a",
  meltingPoint = 1550,
  meltingColor = {
    remapRgb(130, 130, 150)
  },
  sorterOffset = 6.768063,
  metallicOre = true,
}
r8_0.nickel = {
  itemId = 712,
  itemProbability = 140,
  forexIndex = "NIK",
  displayName = "Nikkelérc",
  actionName = "nikkel rudat",
  ingotName = "Nikkel",
  ingotNamePrefix = "a",
  meltingPoint = 1460,
  meltingColor = {
    remapRgb(220, 220, 220)
  },
  sorterOffset = 7.412645,
  metallicOre = true,
}
r8_0.platinum = {
  itemId = 713,
  itemProbability = 65,
  forexIndex = "PLT",
  displayName = "Platinaérc",
  actionName = "platina rudat",
  ingotName = "Platina",
  ingotNamePrefix = "a",
  meltingPoint = 1800,
  meltingColor = {
    remapRgb(160, 170, 250)
  },
  sorterOffset = 8.057227,
  metallicOre = true,
}
r8_0.ruby = {
  itemId = 714,
  itemProbability = 12,
  forexIndex = "RUB",
  displayName = "Rubin",
  actionName = "rubint",
  sorterOffset = 8.701809,
  metallicOre = true,
}
r8_0.chest = {
  itemId = 722,
  itemProbability = 11,
  displayName = "Miner Chest",
  actionName = "Miner Chestet",
  metallicOre = true,
  instantItem = true,
  modelName = "v4_mining_chest2",
}
r8_0.seerconium = {
  itemId = 723,
  itemProbability = 11,
  forexIndex = "SRC",
  displayName = "Sightcronium",
  actionName = "Sightcroniumot",
  metallicOre = true,
  instantItem = true,
  fixedBasePrice = 500000,
}
oreTypes = r8_0
r8_0 = 2.5
for r12_0, r13_0 in pairs(oreTypes) do
  local r14_0 = r13_0.meltingPoint
  if r14_0 then
    r14_0 = "furnaceSpeed"
    local r16_0 = 60
    local r15_0 = r13_0.meltingPoint / 1000 * r16_0 / r8_0
    r13_0[r14_0] = r15_0
  end
end
meltingTime = 75000 / r8_0
railIronCost = 2
railWoodCost = 5
mineCartLength = 1.58921
dieselLocoLength = 1.8262
function findRailConstructionCost(r0_21)
  -- line: [495, 513] id: 21
  local r1_21 = 0
  for r5_21 = 1, #r0_21, 1 do
    local r6_21 = r0_21[r5_21][1]
    if r6_21 == "extend" or r6_21 == "single" or r6_21 == "linked" or r6_21 == "switch" or r6_21 == "extend-switch" or r6_21 == "merge" then
      r1_21 = r1_21 + 1
    end
  end
  return r1_21
end
function canConstructRail(r0_22, r1_22, r2_22, r3_22)
  -- line: [515, 554] id: 22
  if r2_22 < 0 then
    return false
  end
  if r0_22[r2_22] and r0_22[r2_22][r3_22] then
    return false
  end
  if r1_22[r2_22] then
    if r1_22[r2_22][r3_22] then
      return false
    end
    if r1_22[r2_22][r3_22 - 1] then
      return true
    end
    if r1_22[r2_22][r3_22 + 1] then
      return true
    end
  end
  if r1_22[r2_22 - 1] and r1_22[r2_22 - 1][r3_22] then
    return true
  end
  if r1_22[r2_22 + 1] and r1_22[r2_22 + 1][r3_22] then
    return true
  end
  if r0_22[r2_22] then
    if r0_22[r2_22][r3_22 - 1] then
      return true
    end
    if r0_22[r2_22][r3_22 + 1] then
      return true
    end
  end
  if r0_22[r2_22 - 1] and r0_22[r2_22 - 1][r3_22] then
    return true
  end
  if r0_22[r2_22 + 1] and r0_22[r2_22 + 1][r3_22] then
    return true
  end
  return false
end
function doConstructRail(r0_23, r1_23, r2_23, r3_23, r4_23, r5_23)
  -- line: [556, 681] id: 23
  local r6_23 = getNearTracks(r1_23, r3_23, r4_23)
  iprint(r6_23)
  if r5_23 then
    if #r6_23 == 2 then
      local r7_23 = r6_23[1]
      local r8_23 = findRailAngle(r0_23, r7_23.trackId)
      local r9_23 = r6_23[2]
      if r8_23 % PI == findRailAngle(r0_23, r9_23.trackId) % PI then
        return {
          {
            "merge",
            r7_23.trackId,
            r9_23.trackId,
            r3_23,
            r4_23
          }
        }
      else
        return {
          {
            "openup",
            r7_23.trackId
          },
          {
            "openup",
            r9_23.trackId
          },
          {
            "switch",
            r3_23,
            r4_23
          }
        }
      end
    elseif #r6_23 > 1 then
      local r7_23 = {}
      for r11_23 = 1, #r6_23, 1 do
        table.insert(r7_23, {
          "openup",
          r6_23[r11_23].trackId
        })
      end
      table.insert(r7_23, {
        "switch",
        r3_23,
        r4_23
      })
      return r7_23
    else
      return {
        {
          "extend",
          r6_23[1].trackId
        }
      }
    end
  else
    local r7_23 = getNearSwitches(r2_23, r3_23, r4_23)
    local r8_23 = #r7_23 + #r6_23
    if r8_23 == 1 then
      if #r6_23 == 1 then
        local r9_23 = r6_23[1]
        local r10_23 = patan2(r4_23 - r9_23.trackY, r3_23 - r9_23.trackX)
        if findRailAngle(r0_23, r9_23.trackId) % PI == r10_23 % PI then
          return {
            {
              "extend",
              r9_23.trackId
            }
          }
        else
          return {
            {
              "single",
              r3_23,
              r4_23,
              math.deg(r10_23),
              true
            },
            {
              "split",
              r9_23.trackId,
              r9_23.trackX,
              r9_23.trackY
            },
            {
              "switch",
              r9_23.trackX,
              r9_23.trackY
            }
          }
        end
      else
        local r9_23 = r7_23[1]
        return {
          {
            "single",
            r3_23,
            r4_23,
            math.deg(patan2(r4_23 - r9_23.switchY, r3_23 - r9_23.switchX)),
            true
          },
          {
            "extend-switch",
            r9_23.switchId
          }
        }
      end
    elseif r8_23 == 2 then
      if #r6_23 == 2 then
        local r9_23 = r6_23[1]
        local r10_23 = findRailAngle(r0_23, r9_23.trackId) % PI
        local r11_23 = r6_23[2]
        local r12_23 = findRailAngle(r0_23, r11_23.trackId) % PI
        local r13_23 = patan2(r4_23 - r9_23.trackY, r3_23 - r9_23.trackX)
        if r10_23 == r12_23 then
          if r10_23 == r13_23 then
            return {
              {
                "merge",
                r9_23.trackId,
                r11_23.trackId,
                r3_23,
                r4_23
              }
            }
          else
            return {
              {
                "single",
                r3_23,
                r4_23,
                math.deg(r13_23),
                false
              },
              {
                "split",
                r9_23.trackId,
                r9_23.trackX,
                r9_23.trackY
              },
              {
                "split",
                r11_23.trackId,
                r11_23.trackX,
                r11_23.trackY
              },
              {
                "switch",
                r9_23.trackX,
                r9_23.trackY
              },
              {
                "switch",
                r11_23.trackX,
                r11_23.trackY
              }
            }
          end
        elseif r10_23 == r13_23 then
          return {
            {
              "extend",
              r9_23.trackId,
              true
            },
            {
              "split",
              r11_23.trackId,
              r11_23.trackX,
              r11_23.trackY
            },
            {
              "switch",
              r11_23.trackX,
              r11_23.trackY
            }
          }
        elseif r12_23 == r13_23 then
          return {
            {
              "extend",
              r11_23.trackId,
              true
            },
            {
              "split",
              r9_23.trackId,
              r9_23.trackX,
              r9_23.trackY
            },
            {
              "switch",
              r9_23.trackX,
              r9_23.trackY
            }
          }
        end
      elseif #r7_23 == 2 then
        local r9_23 = r7_23[1]
        return {
          {
            "single",
            r3_23,
            r4_23,
            math.deg(patan2(r4_23 - r9_23.switchY, r3_23 - r9_23.switchX)),
            false
          },
          {
            "extend-switch",
            r9_23.switchId
          },
          {
            "extend-switch",
            r7_23[2].switchId
          }
        }
      else
        local r9_23 = r6_23[1]
        local r10_23 = patan2(r4_23 - r9_23.trackY, r3_23 - r9_23.trackX)
        local r11_23 = r7_23[1]
        if findRailAngle(r0_23, r9_23.trackId) % PI == r10_23 % PI then
          return {
            {
              "extend",
              r9_23.trackId,
              true
            },
            {
              "extend-switch",
              r11_23.switchId
            }
          }
        else
          return {
            {
              "single",
              r3_23,
              r4_23,
              math.deg(r10_23),
              false
            },
            {
              "split",
              r9_23.trackId,
              r9_23.trackX,
              r9_23.trackY
            },
            {
              "switch",
              r9_23.trackX,
              r9_23.trackY
            },
            {
              "extend-switch",
              r11_23.switchId
            }
          }
        end
      end
    end
  end
end
function getNearTracks(r0_24, r1_24, r2_24, r3_24)
  -- line: [683, 708] id: 24
  local r4_24 = {}
  local r5_24 = {
    0,
    -1,
    0,
    1,
    -1,
    0,
    1,
    0
  }
  for r9_24 = 1, #r5_24, 2 do
    local r10_24 = r1_24 + r5_24[r9_24]
    local r11_24 = r2_24 + r5_24[r9_24 + 1]
    local r12_24 = r0_24[r10_24] and r0_24[r10_24][r11_24]
    local r13_24 = r3_24 and r3_24[r10_24] and r3_24[r10_24][r11_24]
    local r14_24 = r12_24 or r13_24
    if r14_24 then
      table.insert(r4_24, {
        trackId = r14_24,
        trackX = r10_24,
        trackY = r11_24,
      })
    end
  end
  return r4_24
end
function getNearSwitches(r0_25, r1_25, r2_25)
  -- line: [710, 733] id: 25
  local r3_25 = {}
  local r4_25 = {
    0,
    -1,
    0,
    1,
    -1,
    0,
    1,
    0
  }
  for r8_25 = 1, #r4_25, 2 do
    local r9_25 = r1_25 + r4_25[r8_25]
    local r10_25 = r2_25 + r4_25[r8_25 + 1]
    local r11_25 = r0_25[r9_25] and r0_25[r9_25][r10_25]
    if r11_25 then
      table.insert(r3_25, {
        switchId = r11_25,
        switchX = r9_25,
        switchY = r10_25,
      })
    end
  end
  return r3_25
end
local r9_0 = {}
r9_0[2] = {
  [1] = {
    [1] = 2,
    [2] = 1,
  },
}
r9_0[3] = {
  [1] = {
    [1] = 3,
    [2] = nil,
    [3] = 1,
  },
  [2] = {
    [1] = nil,
    [2] = 3,
    [3] = 2,
  },
  [3] = {
    [1] = 2,
    [2] = 1,
    [3] = nil,
  },
}
r9_0[4] = {
  [1] = {
    [1] = 3,
    [2] = 4,
    [3] = 1,
    [4] = 2,
  },
  [2] = {
    [1] = 4,
    [2] = 3,
    [3] = 2,
    [4] = 1,
  },
  [3] = {
    [1] = 2,
    [2] = 1,
    [3] = 4,
    [4] = 3,
  },
}
switchMatrix = r9_0
locoPassengerSpots = {
  {
    -0.25,
    -1,
    1.35,
    0,
    "casino",
    "roulette_loop"
  },
  {
    -0.25,
    1,
    1.35,
    180,
    "casino",
    "roulette_loop"
  },
  {
    1,
    -0.75,
    1.35,
    0,
    "chainsaw",
    "idle_csaw"
  },
  {
    1,
    0.75,
    1.35,
    180,
    "chainsaw",
    "idle_csaw"
  }
}
oreCartOffsets = {
  {
    4,
    -0.409,
    0.095,
    -0.0219,
    -22.2652,
    0,
    0
  },
  {
    2,
    -0.0585,
    0.0118,
    -0.0219,
    0,
    0,
    58.7106
  },
  {
    1,
    0.3544,
    0.073,
    -0.0137,
    0,
    0,
    0
  },
  {
    5,
    -0.4016,
    -0.1819,
    0.2355,
    -17.6461,
    0,
    0
  },
  {
    3,
    0.3097,
    -0.1695,
    0.2292,
    -12.3947,
    -19.5927,
    33.2397
  },
  {
    1,
    0.1827,
    0.1348,
    0.2644,
    32.0566,
    -60.7096,
    7.051
  },
  {
    4,
    -0.2639,
    0.1789,
    0.3447,
    56.6072,
    -74.6252,
    -56.886
  }
}
machinePosX = minePosX - 13.7135
machinePosY = minePosY + 7.6567
machinePosZ = minePosZ + 1.5229
conveyorStartX = machinePosX + 0.8758
conveyorStartY = machinePosY - 6.9417
conveyorStartZ = machinePosZ - 0.8327
conveyorEndX = machinePosX + 0.8758
conveyorEndY = machinePosY - 0.9892
conveyorEndZ = machinePosZ + 1.4221
conveyorLength = getDistanceBetweenPoints3D(conveyorStartX, conveyorStartY, conveyorStartZ, conveyorEndX, conveyorEndY, conveyorEndZ)
conveyorDuration = 7000
sackOreProportion = 0.16666666666666666
detonationTime = 25000
fuelTankCapacity = 1000
jerryCanCapacity = 10
locoTankCapacity = 40
railIronStack = 50
railIronPrice = math.floor(37500 * globalPriceMultiplier + 0.5)
railIronOffsets = {
  {
    -17.7054,
    9.4165,
    -0.1814,
    -13,
    0,
    176
  },
  {
    -18.6844,
    9.4494,
    -0.1644,
    -13,
    0,
    180
  }
}
railWoodStack = 125
railWoodPrice = math.floor(12500 * globalPriceMultiplier + 0.5)
railWoodOffsets = {
  {
    -19.7923,
    9.1289,
    0.1735,
    0,
    0,
    0
  },
  {
    -20.9152,
    9.1289,
    0.1735,
    0,
    0,
    -2.5
  }
}
mineLampStack = 20
mineLampPrice = math.floor(20000 * globalPriceMultiplier + 0.5)
mineLampOffsets = {
  {
    -20.7103,
    4.6399,
    0.047,
    0,
    0,
    0
  },
  {
    -20.7103,
    6.2763,
    0.047,
    0,
    0,
    -85
  }
}
subRailCarPrice = math.floor(95000 * globalPriceMultiplier + 0.5)
dieselLocoPrice = 2500
trailerOffsets = {
  railIrons = {
    {
      "v4_mine_cargo_rail",
      -0.3941,
      0.3804,
      0.0131,
      0,
      0,
      0
    },
    {
      "v4_mine_cargo_rail",
      0.3961,
      0.3804,
      0.0131,
      0,
      0,
      0
    }
  },
  railWoods = {
    {
      "v4_mine_cargo_wood",
      -0.4237,
      0.3891,
      0.0131,
      0,
      0,
      180
    },
    {
      "v4_mine_cargo_wood",
      0.4274,
      0.3891,
      0.0131,
      0,
      0,
      0
    }
  },
  mineLamps = {
    {
      "v4_mine_cargo_lamp",
      0,
      -0.2947,
      0.0211,
      0,
      0,
      0
    },
    {
      "v4_mine_cargo_lamp",
      0,
      1.0424,
      0.0211,
      0,
      0,
      180
    }
  },
  dieselLoco = {
    {
      "v4_mine_cargo_urmamoto",
      0,
      0.1544,
      -0.2005,
      0,
      0,
      90
    }
  },
  subCartNum = {
    {
      "v4_mine_cargo_cart1",
      0,
      -0.2156,
      -0.2004,
      0,
      0,
      0
    },
    {
      "v4_mine_cargo_cart1",
      0,
      0.879,
      -0.2004,
      0,
      0,
      0
    }
  },
}
orderPoses = {
  {
    -2459.884,
    2487.887,
    13.7742,
    180,
    16,
    "James McGallaghon",
    -2460.6912,
    2482.1836,
    13.0003,
    3,
    3.42979
  },
  {
    -2463.3245,
    2489.7566,
    13.7742,
    0,
    16,
    "Billy Reic Idol",
    -2460.6912,
    2492.1836,
    13.0003,
    3,
    3.42979
  },
  {
    -2461.4534,
    2500.1694,
    13.7742,
    21,
    16,
    "Steven Applepine",
    -2460.6912,
    2502.1833,
    13.0003,
    3,
    3.42979
  }
}
function refreshOrderConstraints(r0_26, r1_26)
  -- line: [884, 950] id: 26
  for r5_26 in pairs(r0_26) do
    if not trailerOffsets[r5_26] then
      r0_26[r5_26] = nil
    end
  end
  if r0_26.railIrons or r0_26.railWoods then
    r0_26.mineLamps = nil
    r0_26.dieselLoco = nil
    r0_26.subCartNum = nil
  elseif r0_26.mineLamps then
    r0_26.railIrons = nil
    r0_26.railWoods = nil
    r0_26.dieselLoco = nil
    r0_26.subCartNum = nil
  elseif r0_26.dieselLoco then
    r0_26.subCartNum = nil
  elseif r0_26.subCartNum then
    r0_26.dieselLoco = nil
  end
  if r0_26.railIrons then
    r0_26.railIrons = math.max(0, math.min(r0_26.railIrons, 2 - math.ceil(r1_26.railIrons / railIronStack)))
    r0_26.railIrons = math.min(#trailerOffsets.railIrons - (r0_26.railWoods or 0), r0_26.railIrons)
    if r0_26.railIrons <= 0 then
      r0_26.railIrons = nil
    end
  end
  if r0_26.railWoods then
    r0_26.railWoods = math.max(0, math.min(r0_26.railWoods, 2 - math.ceil(r1_26.railWoods / railWoodStack)))
    r0_26.railWoods = math.min(#trailerOffsets.railWoods - (r0_26.railIrons or 0), r0_26.railWoods)
    if r0_26.railWoods <= 0 then
      r0_26.railWoods = nil
    end
  end
  if r0_26.mineLamps then
    r0_26.mineLamps = math.max(0, math.min(r0_26.mineLamps, 2 - math.ceil(r1_26.mineLamps / mineLampStack)))
    r0_26.mineLamps = math.min(#trailerOffsets.mineLamps, r0_26.mineLamps)
    if r0_26.mineLamps <= 0 then
      r0_26.mineLamps = nil
    end
  end
  if r0_26.dieselLoco then
    local r2_26 = math.max
    local r3_26 = 0
    local r4_26 = math.min
    local r5_26 = r0_26.dieselLoco or 0
    local r6_26 = r1_26.dieselLoco
    if r6_26 then
      r6_26 = 0 or 1
    else
      r6_26 = 1
    end
    r0_26.dieselLoco = r2_26(r3_26, r4_26(r5_26, r6_26))
    r0_26.dieselLoco = math.min(#trailerOffsets.dieselLoco, r0_26.dieselLoco)
    if r0_26.dieselLoco <= 0 then
      r0_26.dieselLoco = nil
    end
  end
  if r0_26.subCartNum then
    local r2_26 = math.max
    local r3_26 = 0
    local r4_26 = math.min
    local r5_26 = r0_26.subCartNum or 0
    local r6_26 = r1_26.dieselLoco
    if r6_26 then
      r6_26 = 6 or 1
    else
      r6_26 = 1
    end
    r0_26.subCartNum = r2_26(r3_26, r4_26(r5_26, r6_26 - r1_26.subCartNum))
    r0_26.subCartNum = math.min(#trailerOffsets.subCartNum, r0_26.subCartNum)
    if r0_26.subCartNum <= 0 then
      r0_26.subCartNum = nil
    end
  end
end
function getOrderPrice(r0_27)
  -- line: [952, 969] id: 27
  local r1_27 = 0
  local r2_27 = false
  if r0_27.dieselLoco then
    r1_27 = dieselLocoPrice
    r2_27 = true
  else
    r1_27 = r1_27 + railIronPrice * (r0_27.railIrons or 0)
    r1_27 = r1_27 + railWoodPrice * (r0_27.railWoods or 0)
    r1_27 = r1_27 + mineLampPrice * (r0_27.mineLamps or 0)
    r1_27 = r1_27 + dieselLocoPrice * (r0_27.dieselLoco or 0)
    r1_27 = r1_27 + subRailCarPrice * (r0_27.subCartNum or 0)
  end
  return r1_27, r2_27, exports.sGui:thousandsStepper(r1_27) .. (r2_27 and "PP" or " $")
end
function iterateGrid(r0_28, r1_28, r2_28, r3_28, r4_28, r5_28)
  -- line: [973, 984] id: 28
  for r9_28 = r1_28, r3_28, 1 do
    if r0_28[r9_28] then
      for r13_28 = r2_28, r4_28, 1 do
        local r14_28 = r0_28[r9_28][r13_28]
        if r14_28 then
          r5_28(r14_28, r9_28, r13_28)
        end
      end
    end
  end
end
function setPedHeadingTo(r0_29, r1_29, r2_29)
  -- line: [986, 996] id: 29
  if isElement(r0_29) then
    local r3_29, r4_29 = getElementPosition(r0_29)
    if isElement(r1_29) then
      r1_29, r2_29 = getElementPosition(r1_29)
    end
    return setElementRotation(r0_29, 0, 0, math.deg(math.atan2(r4_29 - r2_29, r3_29 - r1_29)) + 90, "default", true)
  end
end
insideFarClipDistance = 36

function formatCorridorNameMineId(r0_7)
    -- line: [92, 96] id: 7
    local r1_7, r2_7 = getLobbyFromMineId(r0_7)
    return lobbyCoords[r1_7][5] .. " bánya " .. r2_7 .. ". járat"
end

function formatCorridorName(r0_8)
    -- line: [98, 102] id: 8
    local r1_8, r2_8 = getLobbyFromCorridor(r0_8)
    return lobbyCoords[r1_8][5] .. " bánya " .. r2_8 .. ". járat"
end